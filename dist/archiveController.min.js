'use strict';angular.module("archiveViewer").controller("archiveCtrl",function(a,l){a.title="Codeparl Angular Archive Viewer";a.file=null;a.zipNames=[];a.content="";a.fileName="";a.currentZip="";a.archiveInfo=[];a.contentServer="server/content-server.php";a.hasNewFile=!1;a.addInfo=function(){var b=jQuery,c;for(c in a.archiveInfo){var d=b(".index-"+c);0<d.length&&(d.attr({"data-type":a.archiveInfo[c].type,"data-path":a.archiveInfo[c].path,"data-open":a.archiveInfo[c].open,"data-index":c}),"file"===
a.archiveInfo[c].type&&0===d.find("span.file-size.small").length&&b("<span>").addClass("position-absolute file-size small").html(a.formatSize(a.archiveInfo[c].size)).appendTo(d.addClass("position-relative")))}};a.getZipList=function(){l({method:"GET",url:a.contentServer,params:{zipList:1}}).then(function(b){a.zipNames=b.data.zipList;a.content=b.data.content;a.currentZip=a.zipNames[0];a.archiveInfo=b.data.info})};a.getZipList();a.analyze=function(b){0<b.target.files.length&&(a.file=b.target.files[0],
a.fileName=a.file.name,a.hasNewFile=!0)};a.uploadFile=function(){var b=new FormData;b.append("file",a.file);0===a.zipNames.length&&b.append("archive",1);l.post(a.contentServer,b,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(c){c.data.zipName&&(a.zipNames.push(c.data.zipName),a.hasNewFile=!1,a.fileName="",c.data.archiveContent&&(a.content=c.data.archiveContent.content))})};a.formatSize=function(b){var c=Math.fround(b/1024);var d=Math.fround(c/1024);var h=Math.fround(d/
1024);if(1024>b)return b+" Bytes";if(1024>c)return c.toFixed(1)+" KB";if(1024>d)return d.toFixed(1)+" MB";if(1024>h)return h.toFixed(1)+" GB"};a.getIndexOf=function(b){b=b.classList;b=b[b.length-1];return b=b.substring(b.lastIndexOf("-")+1)};a.displayAll=function(){(function(b,c,d){b("#archiveContent").on("click",".list-group-item a",function(){var h=b(this),e=h.closest("li.list-group-item"),g=g=e.data("index"),m=e.data("type");if("folder"===m){if(e.data("open")){h.next("ul").slideUp("fast",function(){e.data("open",
!1);e.find("i").eq(0).toggleClass("fa-minus fa-plus ");e.find("i").eq(1).toggleClass("fa-folder-open fa-folder");b(this).remove()});return}e.data("open",!0);e.find("i").eq(0).toggleClass("fa-minus fa-plus");e.find("i").eq(1).toggleClass("fa-folder-open fa-folder")}d({method:"GET",url:c.contentServer,params:{dispaly:g,zipName:c.currentZip,type:m,path:e.data("path"),name:h.text()}}).then(function(k){if(null===k.data.content.content){var n=window.location.protocol+"//"+window.location.host;n+="/"+c.contentServer+
"?n="+(c.currentZip+"&i="+g);window.open(n,"_top")}else c.archiveInfo=k.data.content.info,c.addInfo(),"folder"===m?b(k.data.content.content).insertAfter(h).slideDown("fast"):d.get("../partials/modal.html").then(function(f){c.modalTitle=c.archiveInfo[g].name;f=b(f.data);f.modal({backdrop:"static"}).appendTo("body").modal("show").on("hidden.bs.modal",function(){b(this).remove()});f.find(".modal-title").text(c.modalTitle);!1===c.archiveInfo[g].isText&&c.archiveInfo[g].fileType.match(/(jpg|jpeg|png|gif)/ig)?
f.find(".modal-body").html(b("<img>").attr({alt:c.modalTitle,src:k.data.content.content}).addClass("img-fluid")):c.archiveInfo[g].isText&&(f=ace.edit("editor"),f.setTheme("ace/theme/tomorrow"),f.session.setMode("ace/mode/"+c.archiveInfo[g].fileType.toLowerCase()),f.session.setValue(k.data.content.content),f.setOptions({fontSize:16,readOnly:!0}))})})})})(jQuery,a,l)};a.showZipContent=function(b){b.preventDefault();a.currentZip=a.zipNames[b.target.dataset.index];document.querySelector("ul.zipList .list-group-item.active").classList.remove("active");
b.target.parentNode.classList.add("active");l({method:"GET",url:a.contentServer,params:{archive:a.currentZip}}).then(function(c){a.content=c.data.archiveContent.content;a.archiveInfo=c.data.archiveContent.info;a.addInfo()})};a.displayAll();a.showSidebar=function(b){var c=jQuery;console.log(b);c(b.target).is(".show-sidebar , .show-sidebar *")?(c(".sidebar").removeClass("slideOutLeft"),c(".sidebar").addClass("slideInLeft")):(c(".sidebar").removeClass("slideInLeft"),c(".sidebar").addClass("slideOutLeft"))}});